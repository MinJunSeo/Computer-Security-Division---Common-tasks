# 무효 영역
  
## 무효 영역
  
무효 영역(Invalid Region = Update Region)이란 화면의 일부가 변경되어 다시 그려져야 할 부분을 말한다.  
  
보통 다음과 같은 경우 다시 그려져야 하기 때문에 무효 영역이 발생하게 된다.  
  
1. 윈도우가 처음 생성되었을 때  
2. 윈도우의 위치가 이동되었을 때  
3. 윈도우의 크기가 변경, 최소, 최대화되었을 때  
4. 다른 윈도우에 가려져 있다가 드러날 때 (언커버될 때)  
5. 스크롤 될 때  
  
운영체제는 윈도우의 일부가 지워졌을 때 지워진 작업 영역을 무효로 만들어 윈도우가 다시 그려지도록 한다.  
  
무효 영역은 무효화 된 부분이 얼마나 되는지에 따라 작업 영역 전체가 될 수도 있고, 혹은 일부분만 무효 영역이 될 수도 있다. 무효 영역이 얼마나 되든 간에 무효 영역이 발생하게 되면 운영체제는 해당 윈도우에게 WM_PAINT 메시지를 보내 무효화된 부분을 다시 그릴 수 있도록 한다.  
  
## InvalidateRect
  
그러한 점을 이용하여 사용자가 직접 원하는 타이밍에 원하는 부분을 무효화하여 다시 그리도록 할 수 있다. 그렇게 하기 위해서는 우선 다시 그리고 싶은 부분을 무효화해야 하는데 그때 사용되는 함수가 바로 InvalidateRect 함수이다.  
  
	BOOL InvalidateRect(HWND hWnd, CONST RECT* lpRect, BOOL bErase);
  
hWnd 윈도우의 lpRect 영역을 무효화하여 다시 그리도록 도와주는 함수이다. bErase는 무효화되기 전에 배경을 모두 지운 후 다시 그릴 것인지 아니면 배경을 지우지 않고 그릴 것인지를 결정하는 인수이다. 여기서 두 번째 인자인 lpRect에 NULL을 주면 작업 영역 전체를 무효화할 수 있다.  
  
하지만 작업 영역 전체를 무효화하는 것은 그리 좋은 방법은 아니다. 작업 영역 전체가 무효화될 경우 화면이 깜박거리는 것이 사용자의 눈에 들어오기 때문이다. 그래서 무효화 시키고 싶은 영역은 항상 최소화시키는 것이 좋다.  
  
보통 그렇게 하기 위해서 SetRect 함수를 사용해 무효화하고 싶은 영역을 지정하고, 그 뒤 두 번째 인수로 해당 영역을 전달해 무효화시키는 것이 일반적이다.  
  
그런데 막상 작업을 하다 보면 무효 영역을 계산하는 과정이 굉장히 복잡해지는 경우가 많을 것이다. 그러나 설사 무효 영역 계산에 시간을 소모한다 하더라도 모든 작업 영역을 다시 그리는 것보다는 훨씬 더 빠르기 때문에 다소 귀찮고 어렵더라도 무효 영역은 정확하게 계산해야 한다.  
  
무효 영역을 정확하게 계산한다는 것은 무척 중요한 일이다. 정확하게 계산하지 않을 경우 출력이 엉뚱하게 될 수 있다. 반대로 정확하게 계산하였을 경우 실행 시간의 단축 및 깜박임 문제의 최소화가 되기 때문에 프로그램의 질이 매우 향상된다고 할 수 있다. Windows API 프로그래머에게 있어 무효 영역의 정확한 계산은 좋은 프로그래머로써 인정받는 기술 중 하나인 것이다.  
  
## 다음과 같은 코드는 동작하지 않습니다!
  
	SendMessage(hWnd, WM_PAINT, 0, 0);
  
언뜻 보기에는 제대로 동작할 것처럼 보이는 코드다. hWnd 윈도우에 WM_PAINT 메시지를 보냄으로써 해당 코드를 다시 실행해 작업 영역을 다시 그릴 수 있을 것 같은 느낌이 든다. 하지만 윈도우가 다시 그려지지는 않는다.  
  
해당 코드는 정상적으로 메시지가 전달된다. 하지만 다시 그려지지는 않는다. 왜냐하면 Windows는 무효 영역이 없으면 아예 그리기를 하지 않기 때문이다. 즉 무효 영역이 발생하지 않는 한 무효 영역 이외의 부분은 다시 그려지지 않는다는 이야기다.  
  
## ValidateRect
  
	BOOL ValidateRect(HWND hWnd, CONST RECT* lpRect);
  
InvalidateRect가 작업 영역을 무효화하는 함수였다면 ValidateRect는 작업 영역을 유효화하는, 즉 그리기 영역에서 제외시키는 함수이다. 보통 무효 영역을 정교하게 계산하고자 할 때 사용되는 함수이다.  
  
예를 들면, 다음과 같은 경우 유용하게 사용될 수 있다고 할 수 있다.  
![캡처](https://user-images.githubusercontent.com/51042546/76138876-78692280-608e-11ea-9b32-7129c4b00e0a.JPG)  
  
InvalidateRect로 무효화하기 위해서는 총 4번을 무효화해야 하지만, ValidateRect 함수를 사용하면 한 번만 유효화함으로써 다른 부분을 모두 무효화시킬 수 있다.  
  
## 리전 무효화
  
	BOOL InvalidateRgn(HWND hWnd, HRGN hRgn, BOOL bErase);
	BOOL ValidateRgn(HWND hWnd, HRGN hRgn);
  
리전을 무효화(유효화)시켜 주는 함수이다 리전이란 곡선 및 분리된 영역을 말하는데 좀 더 복잡한 형태의 무효화를 할 수 있도록 도와준다.
